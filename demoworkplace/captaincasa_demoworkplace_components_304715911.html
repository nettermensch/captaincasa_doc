<html>
<head>
<style>
.java {font-family: monospace;background-color: #F0F0F0;}
.xml {font-family: monospace;background-color: #F0F0F0;}
</style>
</head>
<body>
<p>The context of this demo is the creation of a dialog using the CaptainCasa framework for the following purpose: <ul><li>Components</li><li>Straight Controls</li><li>File Up/Download</li><li>Asynchronous Upload</li></ul></p>
<p>The normal upload components (FILEUPLOADLINK, FILEUPLOADBUTTON) directly embed the uploaded content into the normal client-server-communication. The file content is part of the event that is processed on server side.<br><br>When uploading big file sizes this may cause problems:<br><br>(1) The memory required on client and server side is quite high, because the file is kept as a whole both within the client and in the server memory. Only for short time, of course, but this may be enough to cause memory exceptions.<br>(2) The user needs to wait with continuing input until the upload has finished.<br><br>As consequence there are two components providing the possibility to upload file content in an asynchronous way: FILEUPLOADLINKASYNCHRONOUS and FILEUPLOADBUTTONASYNCHRONOUS. For both components you need to define a URL that is the target of the file upload: the content of the file(s) that are uploaded are sent to this URL, as part of the post string of the request. The format of the post string is:<br><br>FILENAME0=...&amp;CONTENT0=...FILENAME1=...&amp;CONTENT1=....<br><br>The file name is transferred in escaped characters, the content as hexadecimal string (&#34;FF203040...&#34;).<br><br>On server side there is a default, servlet based management for receiving the files - please take a look into the code. You have two options how you want to receive the upload content:<br><br>(1) as byte[] array - this is easier from programming point of view, but means that the whole file is kept on server side for a short time in memory.<br>(2) as character stream - this is more complex to program, because you need to parse the string on your own. But, of course, the memory consumption is much less - the file&#39;s content is &#34;floating&#34; through your program only.<br>(3) as sequence of byte streams, one per file - this is a much more comfortable way of parsing the content of the character stream: for each file that is passed you pass back one output stream into which the content of the upload file is passed<br><br>After having successfully uploaded the file, the client will invoke the corresponding action listener on server side and send the event &#34;BaseActionEventUploadAsynchronousFinished&#34;.<br></p>
<p>This is the XML layout definition:</p>
<p class="xml">&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;utf-8&#34;?&gt;<br>&lt;t:layoutdefinition&nbsp;xmlns:t=&#34;http://www.CaptainCasa.com/controllibrary/t&#34;&nbsp;xmlns:tpbc=&#34;http://www.CaptainCasa.com/controllibrary/tpbc&#34;&nbsp;&gt;<br>&lt;t:beanprocessing&nbsp;id=&#34;g_1&#34;&nbsp;&gt;<br>&lt;t:jshowurl&nbsp;id=&#34;g_2&#34;&nbsp;/&gt;<br>&lt;/t:beanprocessing&gt;<br>&lt;t:rowdemobodypane&nbsp;id=&#34;g_3&#34;&nbsp;objectbinding=&#34;#{d.DemoFileUploadAsynchronous}&#34;&nbsp;rowdistance=&#34;#{ccstylevalue[&amp;#39;@defaultrowdistance@&amp;#39;]}&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_4&#34;&nbsp;&gt;<br>&lt;t:foldablepane&nbsp;id=&#34;g_5&#34;&nbsp;rowdistance=&#34;#{ccstylevalue[&amp;#39;@defaultrowdistance@&amp;#39;]}&#34;&nbsp;text=&#34;Server&nbsp;Side&nbsp;byte[]&nbsp;Processing&#34;&nbsp;width=&#34;100%&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_6&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_7&#34;&nbsp;text=&#34;Link&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:fileuploadlinkasynchronous&nbsp;id=&#34;g_8&#34;&nbsp;actionListener=&#34;#{d.DemoFileUploadAsynchronous.onRefresh}&#34;&nbsp;asynchronousuploadurl=&#34;#{d.DemoFileUploadAsynchronous.uploadURL}&#34;&nbsp;fileextensions=&#34;jpg;jpeg;tif;tiff;pdf;png&#34;&nbsp;imagereduction=&#34;600;400;85&#34;&nbsp;multiselect=&#34;true&#34;&nbsp;text=&#34;Upload&nbsp;File...&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_9&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_10&#34;&nbsp;text=&#34;Button&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:fileuploadbuttonasynchronous&nbsp;id=&#34;g_11&#34;&nbsp;actionListener=&#34;#{d.DemoFileUploadAsynchronous.onRefresh}&#34;&nbsp;asynchronousuploadurl=&#34;#{d.DemoFileUploadAsynchronous.uploadURL}&#34;&nbsp;fileextensions=&#34;txt;jpg;png&#34;&nbsp;maxfilesize=&#34;100000000&#34;&nbsp;maxnumberoffiles=&#34;4&#34;&nbsp;multiselect=&#34;true&#34;&nbsp;text=&#34;Upload&nbsp;File...&#34;&nbsp;width=&#34;100+&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_12&#34;&nbsp;&gt;<br>&lt;t:coldistance&nbsp;id=&#34;g_13&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:label&nbsp;id=&#34;g_14&#34;&nbsp;cutwidth=&#34;true&#34;&nbsp;font=&#34;size:8&#34;&nbsp;text=&#34;#{d.DemoFileUploadAsynchronous.uploadURL}&#34;&nbsp;width=&#34;100%&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;/t:foldablepane&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_15&#34;&nbsp;&gt;<br>&lt;t:foldablepane&nbsp;id=&#34;g_16&#34;&nbsp;rowdistance=&#34;#{ccstylevalue[&amp;#39;@defaultrowdistance@&amp;#39;]}&#34;&nbsp;text=&#34;Server&nbsp;Side&nbsp;Stream&nbsp;Processing&#34;&nbsp;width=&#34;100%&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_33&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_34&#34;&nbsp;font=&#34;weight:bold&#34;&nbsp;text=&#34;Direct&nbsp;processing&nbsp;of&nbsp;client&nbsp;stream&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_17&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_18&#34;&nbsp;text=&#34;Link&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:fileuploadlinkasynchronous&nbsp;id=&#34;g_19&#34;&nbsp;actionListener=&#34;#{d.DemoFileUploadAsynchronous.onRefresh}&#34;&nbsp;asynchronousuploadurl=&#34;#{d.DemoFileUploadAsynchronous.uploadStreamURL}&#34;&nbsp;fileextensions=&#34;jpg;jpeg;tif;tiff;pdf;png&#34;&nbsp;maxfilesize=&#34;100000000&#34;&nbsp;multiselect=&#34;true&#34;&nbsp;text=&#34;Upload&nbsp;File...&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_20&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_21&#34;&nbsp;text=&#34;Button&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:fileuploadbuttonasynchronous&nbsp;id=&#34;g_22&#34;&nbsp;actionListener=&#34;#{d.DemoFileUploadAsynchronous.onRefresh}&#34;&nbsp;asynchronousuploadurl=&#34;#{d.DemoFileUploadAsynchronous.uploadStreamURL}&#34;&nbsp;fileextensions=&#34;txt;jpg;png&#34;&nbsp;maxfilesize=&#34;100000000&#34;&nbsp;multiselect=&#34;true&#34;&nbsp;text=&#34;Upload&nbsp;File...&#34;&nbsp;width=&#34;100+&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_23&#34;&nbsp;&gt;<br>&lt;t:coldistance&nbsp;id=&#34;g_24&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:label&nbsp;id=&#34;g_25&#34;&nbsp;cutwidth=&#34;true&#34;&nbsp;font=&#34;size:8&#34;&nbsp;text=&#34;#{d.DemoFileUploadAsynchronous.uploadStreamURL}&#34;&nbsp;width=&#34;100%&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_36&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_37&#34;&nbsp;font=&#34;weight:bold&#34;&nbsp;text=&#34;Comfortable&nbsp;processing&nbsp;of&nbsp;client&nbsp;stream&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_38&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_39&#34;&nbsp;text=&#34;Link&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:fileuploadlinkasynchronous&nbsp;id=&#34;g_40&#34;&nbsp;actionListener=&#34;#{d.DemoFileUploadAsynchronous.onRefresh}&#34;&nbsp;asynchronousuploadurl=&#34;#{d.DemoFileUploadAsynchronous.uploadStreamURLComfortable}&#34;&nbsp;fileextensions=&#34;jpg;jpeg;tif;tiff;pdf;png&#34;&nbsp;maxfilesize=&#34;100000000&#34;&nbsp;multiselect=&#34;true&#34;&nbsp;text=&#34;Upload&nbsp;File...&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_41&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_42&#34;&nbsp;text=&#34;Button&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:fileuploadbuttonasynchronous&nbsp;id=&#34;g_43&#34;&nbsp;actionListener=&#34;#{d.DemoFileUploadAsynchronous.onRefresh}&#34;&nbsp;asynchronousuploadurl=&#34;#{d.DemoFileUploadAsynchronous.uploadStreamURLComfortable}&#34;&nbsp;fileextensions=&#34;txt;jpg;png&#34;&nbsp;maxfilesize=&#34;100000000&#34;&nbsp;multiselect=&#34;true&#34;&nbsp;text=&#34;Upload&nbsp;File...&#34;&nbsp;width=&#34;100+&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_44&#34;&nbsp;&gt;<br>&lt;t:coldistance&nbsp;id=&#34;g_45&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:label&nbsp;id=&#34;g_46&#34;&nbsp;cutwidth=&#34;true&#34;&nbsp;font=&#34;size:8&#34;&nbsp;text=&#34;#{d.DemoFileUploadAsynchronous.uploadStreamURLComfortable}&#34;&nbsp;width=&#34;100%&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;/t:foldablepane&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_26&#34;&nbsp;&gt;<br>&lt;t:foldablepane&nbsp;id=&#34;g_27&#34;&nbsp;height=&#34;100%&#34;&nbsp;rowdistance=&#34;#{ccstylevalue[&amp;#39;@defaultrowdistance@&amp;#39;]}&#34;&nbsp;text=&#34;Content,&nbsp;that&nbsp;was&nbsp;uploaded&#34;&nbsp;width=&#34;100%&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_28&#34;&nbsp;coldistance=&#34;5&#34;&nbsp;&gt;<br>&lt;t:button&nbsp;id=&#34;g_29&#34;&nbsp;actionListener=&#34;#{d.DemoFileUploadAsynchronous.onClear}&#34;&nbsp;text=&#34;Clear&#34;&nbsp;width=&#34;100+&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_30&#34;&nbsp;&gt;<br>&lt;t:textarea&nbsp;id=&#34;g_31&#34;&nbsp;height=&#34;100%;100&#34;&nbsp;text=&#34;#{d.DemoFileUploadAsynchronous.content}&#34;&nbsp;width=&#34;100%&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;/t:foldablepane&gt;<br>&lt;/t:row&gt;<br>&lt;/t:rowdemobodypane&gt;<br>&lt;t:pageaddons&nbsp;id=&#34;g_pa&#34;/&gt;<br>&lt;/t:layoutdefinition&gt;</p>
<p>This is the Java code:</p>
<p class="java">package&nbsp;workplace;<br><br>import&nbsp;java.io.FileOutputStream;<br>import&nbsp;java.io.InputStream;<br>import&nbsp;java.io.OutputStream;<br>import&nbsp;java.io.Serializable;<br><br>import&nbsp;javax.faces.event.ActionEvent;<br><br>import&nbsp;org.eclnt.editor.annotations.CCGenClass;<br>import&nbsp;org.eclnt.jsfserver.bufferedcontent.DefaultUploadContent;<br>import&nbsp;org.eclnt.jsfserver.bufferedcontent.DefaultUploadStreamContent;<br>import&nbsp;org.eclnt.jsfserver.bufferedcontent.DefaultUploadStreamContentBySeparateOutputStreams;<br>import&nbsp;org.eclnt.jsfserver.bufferedcontent.UploadContentMgr;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.Statusbar;<br>import&nbsp;org.eclnt.jsfserver.util.HttpSessionAccess;<br>import&nbsp;org.eclnt.util.file.FileManager;<br>import&nbsp;org.eclnt.util.log.CLog;<br>import&nbsp;org.eclnt.util.valuemgmt.UniqueIdCreator;<br>import&nbsp;org.eclnt.util.valuemgmt.ValueManager;<br>import&nbsp;org.eclnt.workplace.IWorkpageDispatcher;<br>import&nbsp;org.eclnt.workplace.WorkpageDefaultLifecycleListener;<br><br>@CCGenClass&nbsp;(expressionBase=&#34;#{d.DemoFileUploadAsynchronous}&#34;)<br><br>public&nbsp;class&nbsp;DemoFileUploadAsynchronous&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;PageBean<br>&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;Serializable<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;inner&nbsp;classes<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;/*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;In&nbsp;this&nbsp;implementation&nbsp;each&nbsp;file&nbsp;that&nbsp;is&nbsp;uploaded&nbsp;is&nbsp;passed&nbsp;as&nbsp;byte[]&nbsp;array.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Disadvantag:&nbsp;memory&nbsp;consumption!&nbsp;The&nbsp;file&nbsp;is&nbsp;kept&nbsp;in&nbsp;memory&nbsp;at&nbsp;least&nbsp;for&nbsp;some<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;short&nbsp;duration&nbsp;of&nbsp;time.&nbsp;-&nbsp;Not&nbsp;use-able&nbsp;for&nbsp;big&nbsp;files&nbsp;e.g.&nbsp;&gt;&nbsp;10MB!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;MyUploadContent&nbsp;extends&nbsp;DefaultUploadContent<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;beginPassing()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;=&nbsp;&#34;Upload&nbsp;started.&#92;n&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;passClientFile(String&nbsp;fileName,&nbsp;byte[]&nbsp;bytes)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;+=&nbsp;&#34;File&nbsp;was&nbsp;passed:&nbsp;client&nbsp;name&nbsp;&#34;&nbsp;+&nbsp;fileName&nbsp;+&nbsp;&#34;,&nbsp;length&nbsp;&#34;&nbsp;+&nbsp;bytes.length&nbsp;+&#34;&#92;n&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;endPassing()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;+=&nbsp;&#34;Upload&nbsp;ended.&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;/*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;In&nbsp;this&nbsp;example&nbsp;the&nbsp;stream&nbsp;content&nbsp;that&nbsp;is&nbsp;passed&nbsp;from&nbsp;the&nbsp;client&nbsp;side&nbsp;is&nbsp;directly<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;processed.&nbsp;You&nbsp;can&nbsp;see&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;upload&nbsp;in&nbsp;the&nbsp;m_content.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;MyUploadStreamContent&nbsp;extends&nbsp;DefaultUploadStreamContent<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;beginPassing()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;=&nbsp;&#34;Stream&nbsp;upload&nbsp;started.&#92;n&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;passClientFilesAsStream(InputStream&nbsp;stream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuffer&nbsp;sb&nbsp;=&nbsp;new&nbsp;StringBuffer();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(true)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;b1&nbsp;=&nbsp;stream.read();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(b1&nbsp;&lt;&nbsp;0)&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;c&nbsp;=&nbsp;(char)b1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(c);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;+=&nbsp;sb.toString()+&nbsp;&#34;&#92;n&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLog.L.log(CLog.LL_ERR,&#34;error&nbsp;when&nbsp;receivng&nbsp;file&nbsp;from&nbsp;client&#34;,t);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;endPassing()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m_content.length()&nbsp;&gt;&nbsp;20000)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;=&nbsp;m_content.substring(0,20000)&nbsp;+&nbsp;&#34;...&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;+=&nbsp;&#34;&#92;nStream&nbsp;upload&nbsp;ended.&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;/*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;In&nbsp;this&nbsp;example&nbsp;the&nbsp;files&nbsp;are&nbsp;sent&nbsp;one&nbsp;by&nbsp;one.&nbsp;For&nbsp;each&nbsp;file&nbsp;one&nbsp;output&nbsp;stream<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;is&nbsp;requested&nbsp;into&nbsp;which&nbsp;the&nbsp;content&nbsp;is&nbsp;written.&nbsp;In&nbsp;the&nbsp;example&nbsp;a&nbsp;file&nbsp;is&nbsp;generated<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;in&nbsp;the&nbsp;servlet-temp-directory&nbsp;for&nbsp;each&nbsp;file&nbsp;that&nbsp;is&nbsp;passed.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;MyUploadStreamContentComfortable&nbsp;extends&nbsp;DefaultUploadStreamContentBySeparateOutputStreams<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;beginPassing()&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;OutputStream&nbsp;passingFileStarted(String&nbsp;fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;serverFileName&nbsp;=&nbsp;HttpSessionAccess.getServletTempDirectory()+&#34;/tempfiles/&#34;+UniqueIdCreator.createUUID();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverFileName&nbsp;=&nbsp;ValueManager.encodeIntoValidFileName(serverFileName,false);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileManager.ensureDirectoryForFileExists(serverFileName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;+=&nbsp;&#34;&#92;nStarting&nbsp;upload&nbsp;of&nbsp;client&nbsp;file:&nbsp;&#34;&nbsp;+&nbsp;fileName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;+=&nbsp;&#34;&#92;nStoring&nbsp;it&nbsp;in:&nbsp;&#34;&nbsp;+&nbsp;serverFileName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileOutputStream&nbsp;fos&nbsp;=&nbsp;new&nbsp;FileOutputStream(serverFileName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fos;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;Error(&#34;Problem&nbsp;processing&nbsp;upload&nbsp;file:&nbsp;&#34;&nbsp;+&nbsp;fileName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;passingFileFinished(String&nbsp;fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;+=&nbsp;&#34;&#92;nFinished&nbsp;uploading&nbsp;of&nbsp;client&nbsp;file:&nbsp;&#34;&nbsp;+&nbsp;fileName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;endPassing()&nbsp;{&nbsp;}&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;members<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;MyUploadContent&nbsp;m_uploadContent;<br>&nbsp;&nbsp;&nbsp;&nbsp;MyUploadStreamContent&nbsp;m_uploadStreamContent;<br>&nbsp;&nbsp;&nbsp;&nbsp;MyUploadStreamContentComfortable&nbsp;m_uploadStreamContentComfortable;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;m_content&nbsp;=&nbsp;&#34;Nothing&nbsp;uploaded&nbsp;yet.&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;constructors<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DemoFileUploadAsynchronous(IWorkpageDispatcher&nbsp;dispatcher)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(dispatcher);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_uploadContent&nbsp;=&nbsp;new&nbsp;MyUploadContent();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UploadContentMgr.add(m_uploadContent);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_uploadStreamContent&nbsp;=&nbsp;new&nbsp;MyUploadStreamContent();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UploadContentMgr.add(m_uploadStreamContent);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_uploadStreamContentComfortable&nbsp;=&nbsp;new&nbsp;MyUploadStreamContentComfortable();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UploadContentMgr.add(m_uploadStreamContentComfortable);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getWorkpage().addLifecycleListener(new&nbsp;WorkpageDefaultLifecycleListener()&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;reactOnDestroyed()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.reactOnDestroyed();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UploadContentMgr.remove(m_uploadContent);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UploadContentMgr.remove(m_uploadStreamContent);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UploadContentMgr.remove(m_uploadStreamContentComfortable);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;public&nbsp;usage<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;private&nbsp;usage<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getUploadURL()&nbsp;{&nbsp;return&nbsp;m_uploadContent.getURL();&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getUploadStreamURL()&nbsp;{&nbsp;return&nbsp;m_uploadStreamContent.getURL();&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getUploadStreamURLComfortable()&nbsp;{&nbsp;return&nbsp;m_uploadStreamContentComfortable.getURL();&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getContent()&nbsp;{&nbsp;return&nbsp;m_content;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onRefresh(ActionEvent&nbsp;event)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;+=&nbsp;&#34;&#92;nActionListener&nbsp;onRefresh:&nbsp;File&nbsp;upload&nbsp;processing&nbsp;finished.&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statusbar.outputSuccess(&#34;File&nbsp;was&nbsp;uploaded!&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onClear(javax.faces.event.ActionEvent&nbsp;event)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_content&nbsp;=&nbsp;&#34;&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>}<br></p>
</body>
</html>
