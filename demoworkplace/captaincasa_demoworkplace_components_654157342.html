<p>The context of this demo is the creation of a dialog using the CaptainCasa framework for the following purpose: <ul><li>Components</li><li>Straight Controls</li><li>Field Control</li><li>Open popup at selected text</li></ul></p>
<p>The FIELD and TEXTAREA component are able to transfer the current text selection information to the backend processing.<br><br>To do so, bing the attribute TEXTSELECTION to some property. The property is used in two directions:<br><br>1. The actual text selection of the component is filled into this property with every round trip from the client to the server.<br>2. You can actively set the text selection value on server side and then trigger the TRIGGERTEXTSELECTION, so that the corresponding selection will be executed on client side as part of the response processing.<br><br>The value of TEXTSELECTION is a comma separated string of integer values:<br><br>1. the caret position<br>2. the begin of selection<br>3. the end of selection<br>4. the left-pixel position within the component<br>5. the top-pixel position within the component<br>6. the height of the selected text<br><br>As consequence you can now open dialog popups directly below the selected text.<br><br>For finding the text position we use some external JS-library &#34;caret.js&#34;. Please find details here: https://github.com/ichord/Caret.js</p>
<p>This is the XML layout definition:</p>
<p class="xml">&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;utf-8&#34;?&gt;<br>&lt;t:layoutdefinition&nbsp;xmlns:t=&#34;http://www.CaptainCasa.com/controllibrary/t&#34;&nbsp;xmlns:tpbc=&#34;http://www.CaptainCasa.com/controllibrary/tpbc&#34;&nbsp;&gt;<br>&lt;t:rowdemobodypane&nbsp;id=&#34;g_1&#34;&nbsp;objectbinding=&#34;#{d.DemoTextEditor}&#34;&nbsp;rowdistance=&#34;#{ccstylevalue[&amp;#39;@defaultrowdistance@&amp;#39;]}&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_2&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_3&#34;&nbsp;stylevariant=&#34;ccbig&#34;&nbsp;text=&#34;Text&nbsp;editor&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_4&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_5&#34;&nbsp;text=&#34;Presse&nbsp;ctrl-space&nbsp;within&nbsp;the&nbsp;editor:&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_6&#34;&nbsp;&gt;<br>&lt;t:textarea&nbsp;id=&#34;MYEDITOR&#34;&nbsp;actionListener=&#34;#{d.DemoTextEditor.onOpenDialog}&#34;&nbsp;height=&#34;100%&#34;&nbsp;popupmenu=&#34;TEXTEDITORMENU&#34;&nbsp;requestfocus=&#34;#{d.DemoTextEditor.textRequestFocus}&#34;&nbsp;selectallwhenfocussed=&#34;false&#34;&nbsp;text=&#34;#{d.DemoTextEditor.text}&#34;&nbsp;textselectioninfo=&#34;#{d.DemoTextEditor.textSelectionInfo}&#34;&nbsp;triggertextselection=&#34;#{d.DemoTextEditor.trigger}&#34;&nbsp;width=&#34;100%&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_7&#34;&nbsp;&gt;<br>&lt;t:button&nbsp;id=&#34;g_8&#34;&nbsp;text=&#34;Sync&#34;&nbsp;width=&#34;100+&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_9&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_10&#34;&nbsp;stylevariant=&#34;ccbig&#34;&nbsp;text=&#34;Server&nbsp;side&nbsp;data&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_11&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_12&#34;&nbsp;text=&#34;Selection&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:field&nbsp;id=&#34;g_13&#34;&nbsp;text=&#34;#{d.DemoTextEditor.textSelectionInfo}&#34;&nbsp;width=&#34;100%&#34;&nbsp;/&gt;<br>&lt;t:coldistance&nbsp;id=&#34;g_14&#34;&nbsp;/&gt;<br>&lt;t:button&nbsp;id=&#34;g_15&#34;&nbsp;actionListener=&#34;#{d.DemoTextEditor.onSelectAction}&#34;&nbsp;text=&#34;Select&nbsp;in&nbsp;text&nbsp;area&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_16&#34;&nbsp;rendered=&#34;false&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_17&#34;&nbsp;text=&#34;Text&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:textpane&nbsp;id=&#34;g_18&#34;&nbsp;text=&#34;#{d.DemoTextEditor.text}&#34;&nbsp;width=&#34;100%&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;/t:rowdemobodypane&gt;<br>&lt;t:popupmenu&nbsp;id=&#34;TEXTEDITORMENU&#34;&nbsp;&gt;<br>&lt;t:menuitem&nbsp;id=&#34;g_19&#34;&nbsp;command=&#34;AAA&#34;&nbsp;hotkey=&#34;ctrl-32&#34;&nbsp;text=&#34;Insert&nbsp;&amp;#34;aaa&amp;#34;&#34;&nbsp;/&gt;<br>&lt;/t:popupmenu&gt;<br>&lt;t:pageaddons&nbsp;id=&#34;g_pa&#34;/&gt;<br>&lt;/t:layoutdefinition&gt;</p>
<p>This is the Java code:</p>
<p class="java">package&nbsp;workplace;<br><br>import&nbsp;java.io.Serializable;<br><br>import&nbsp;org.eclnt.editor.annotations.CCGenClass;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.ModalPopup;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.OKPopup;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.OKPopup.IOKListener;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.Statusbar;<br>import&nbsp;org.eclnt.jsfserver.elements.util.Trigger;<br>import&nbsp;org.eclnt.jsfserver.session.RequestFocusManager;<br>import&nbsp;org.eclnt.util.valuemgmt.ValueManager;<br>import&nbsp;org.eclnt.workplace.IWorkpageDispatcher;<br><br>@CCGenClass&nbsp;(expressionBase=&#34;#{d.DemoTextEditor}&#34;)<br><br>public&nbsp;class&nbsp;DemoTextEditor<br>&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;PageBean&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;Serializable<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;members<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br><br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;m_text&nbsp;=&nbsp;&#34;This&nbsp;is&nbsp;some&nbsp;to&nbsp;be&nbsp;edited.&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;Trigger&nbsp;m_trigger&nbsp;=&nbsp;new&nbsp;Trigger();<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;important&nbsp;to&nbsp;be&nbsp;set,&nbsp;so&nbsp;that&nbsp;the&nbsp;client&nbsp;knows&nbsp;that&nbsp;text&nbsp;selection&nbsp;should<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;be&nbsp;transferred!&nbsp;The&nbsp;value&nbsp;&#34;-1;-1;-1&#34;&nbsp;will&nbsp;be&nbsp;ignored&nbsp;on&nbsp;client&nbsp;side<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;m_textSelectionInfo&nbsp;=&nbsp;&#34;-1;-1;-1&#34;;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;m_textRequestFocus;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;constructors&nbsp;&amp;&nbsp;initialization<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DemoTextEditor(IWorkpageDispatcher&nbsp;workpageDispatcher)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(workpageDispatcher);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getPageName()&nbsp;{&nbsp;return&nbsp;&#34;/workplace/demotexteditor.jsp&#34;;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getRootExpressionUsedInPage()&nbsp;{&nbsp;return&nbsp;&#34;#{d.DemoTextEditor}&#34;;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;public&nbsp;usage<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Trigger&nbsp;getTrigger()&nbsp;{&nbsp;return&nbsp;m_trigger;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getTextSelectionInfo()&nbsp;{&nbsp;return&nbsp;m_textSelectionInfo;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setTextSelectionInfo(String&nbsp;value)&nbsp;{&nbsp;this.m_textSelectionInfo&nbsp;=&nbsp;value;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getText()&nbsp;{&nbsp;return&nbsp;m_text;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setText(String&nbsp;value)&nbsp;{&nbsp;this.m_text&nbsp;=&nbsp;value;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onOpenDialog(javax.faces.event.ActionEvent&nbsp;event)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;a&nbsp;popup&nbsp;is&nbsp;opened&nbsp;at&nbsp;the&nbsp;text&nbsp;position.&nbsp;In&nbsp;the&nbsp;example&nbsp;we&nbsp;use&nbsp;a<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;simple&nbsp;OK-popup,&nbsp;but&nbsp;you&nbsp;can&nbsp;take&nbsp;any&nbsp;other&nbsp;Modeless-&nbsp;or&nbsp;ModalPopup<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;instance,&nbsp;of&nbsp;course!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int[]&nbsp;selectionInfos&nbsp;=&nbsp;ValueManager.decodeStraightIntCSV(m_textSelectionInfo);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;caretPos&nbsp;=&nbsp;selectionInfos[0];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;selBegin&nbsp;=&nbsp;selectionInfos[1];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;selEnd&nbsp;=&nbsp;selectionInfos[2];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;caretLeft&nbsp;=&nbsp;selectionInfos[3];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;caretTop&nbsp;=&nbsp;selectionInfos[4];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;int&nbsp;caretHeight&nbsp;=&nbsp;selectionInfos[5];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;selectedText&nbsp;=&nbsp;m_text.substring(selBegin,selEnd);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OKPopup&nbsp;okp&nbsp;=&nbsp;OKPopup.createInstance<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;A&nbsp;dialog&#34;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;This&nbsp;dialog&nbsp;should&nbsp;be&nbsp;opened&nbsp;close&nbsp;to&nbsp;the&nbsp;text&nbsp;caret&nbsp;position.&#92;n&#92;n&#34;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&#34;The&nbsp;text&nbsp;selected&nbsp;by&nbsp;the&nbsp;user&nbsp;is:&nbsp;&#34;&nbsp;+&nbsp;selectedText&nbsp;+&nbsp;&#34;&#92;n&#92;n&#34;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&#34;After&nbsp;pressing&nbsp;OK,&nbsp;&#92;&#34;aaa&#92;&#34;&nbsp;will&nbsp;be&nbsp;added&nbsp;at&nbsp;the&nbsp;caret&nbsp;position&nbsp;and&nbsp;some&nbsp;text&nbsp;selection&nbsp;will&nbsp;be&nbsp;executed.&#34;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;IOKListener()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;reactOnOK()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(caretPos&nbsp;&gt;=&nbsp;0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_text&nbsp;=&nbsp;m_text.substring(0,selBegin)&nbsp;+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;aaa&#34;&nbsp;+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_text.substring(selEnd);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_textSelectionInfo&nbsp;=&nbsp;caretPos&nbsp;+&nbsp;&#34;;&#34;&nbsp;+&nbsp;caretPos&nbsp;+&nbsp;&#34;;&#34;&nbsp;+&nbsp;(caretPos+3);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_trigger.trigger();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_text&nbsp;+=&nbsp;&#34;aaa&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModalPopup&nbsp;mp&nbsp;=&nbsp;okp.getModalPopup();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;x,y&nbsp;position&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;text&nbsp;are&nbsp;node&#39;s&nbsp;x,y&nbsp;position,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;but&nbsp;shifted&nbsp;by&nbsp;the&nbsp;x,y&nbsp;position&nbsp;of&nbsp;the&nbsp;selection<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mp.setLeftTopReferenceComponentIdOver(&#34;MYEDITOR&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mp.setLeft(caretLeft);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mp.setTop(caretTop+caretHeight);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;optional:&nbsp;explicit&nbsp;sizing<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mp.setWidth(400);&nbsp;//&nbsp;optional:&nbsp;explicit&nbsp;sizing<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mp.setHeight(300);&nbsp;//&nbsp;optional:&nbsp;explicit&nbsp;sizing<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statusbar.outputSuccess(&#34;Opened&nbsp;popup&nbsp;at:&nbsp;&#34;&nbsp;+&nbsp;caretLeft&nbsp;+&nbsp;&#34;/&#34;&nbsp;+&nbsp;(caretTop+caretHeight));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.printStackTrace();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statusbar.outputAlert(t.toString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;long&nbsp;getTextRequestFocus()&nbsp;{&nbsp;return&nbsp;m_textRequestFocus;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onSelectAction(javax.faces.event.ActionEvent&nbsp;event)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_textRequestFocus&nbsp;=&nbsp;RequestFocusManager.getNewRequestFocusCounter();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_trigger.trigger();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;private&nbsp;usage<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>}<br></p>
