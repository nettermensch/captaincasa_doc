<html>
<head>
<style>
.java {font-family: monospace;background-color: #F0F0F0;}
.xml {font-family: monospace;background-color: #F0F0F0;}
</style>
</head>
<body>
<p>The context of this demo is the creation of a dialog using the CaptainCasa framework for the following purpose: <ul><li>General</li><li>Server side JFreeChart</li><li>Pie Chart</li></ul></p>
<p>In this demo, charts are created on server side - using the JFreeChart library. The image of the chart is transferred to the client, but not as URL but as hex string of data.<br><br>The component that is used within the layout is the HEXIMAGE component, that is able to render an image out of an hexstring representation of data (e.g. &#34;af6e4453&#34;).<br><br>Have a look into the server side Java program: the image is created using the JFreeChart library, and then the image is transferred into a hex representation using the ValueManager class that comes with the server side library of Enterprise Client.</p>
<p>This is the XML layout definition:</p>
<p class="xml">&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;utf-8&#34;?&gt;<br>&lt;t:layoutdefinition&nbsp;xmlns:t=&#34;http://www.CaptainCasa.com/controllibrary/t&#34;&nbsp;xmlns:tpbc=&#34;http://www.CaptainCasa.com/controllibrary/tpbc&#34;&nbsp;&gt;<br>&lt;t:rowdemobodypane&nbsp;id=&#34;g_1&#34;&nbsp;objectbinding=&#34;#{d.DemoCharts}&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_2&#34;&nbsp;&gt;<br>&lt;t:fixgrid&nbsp;id=&#34;g_3&#34;&nbsp;bordercolor=&#34;#e0e0e0&#34;&nbsp;borderheight=&#34;1&#34;&nbsp;borderwidth=&#34;1&#34;&nbsp;objectbinding=&#34;#{d.demoCharts.rows}&#34;&nbsp;rowheight=&#34;16&#34;&nbsp;sbvisibleamount=&#34;5&#34;&nbsp;width=&#34;100%&#34;&nbsp;&gt;<br>&lt;t:gridcol&nbsp;id=&#34;g_4&#34;&nbsp;text=&#34;Town&#34;&nbsp;width=&#34;50%&#34;&nbsp;&gt;<br>&lt;t:field&nbsp;id=&#34;g_5&#34;&nbsp;text=&#34;.{town}&#34;&nbsp;/&gt;<br>&lt;/t:gridcol&gt;<br>&lt;t:gridcol&nbsp;id=&#34;g_6&#34;&nbsp;text=&#34;Inhabitants&#34;&nbsp;width=&#34;50%&#34;&nbsp;&gt;<br>&lt;t:formattedfield&nbsp;id=&#34;g_7&#34;&nbsp;align=&#34;right&#34;&nbsp;format=&#34;double&#34;&nbsp;value=&#34;.{inhabitants}&#34;&nbsp;/&gt;<br>&lt;/t:gridcol&gt;<br>&lt;/t:fixgrid&gt;<br>&lt;/t:row&gt;<br>&lt;t:rowdistance&nbsp;id=&#34;g_8&#34;&nbsp;/&gt;<br>&lt;t:row&nbsp;id=&#34;g_9&#34;&nbsp;&gt;<br>&lt;t:button&nbsp;id=&#34;g_10&#34;&nbsp;actionListener=&#34;#{d.demoCharts.onCreateNewTown}&#34;&nbsp;text=&#34;Add&nbsp;new&nbsp;Town&#34;&nbsp;/&gt;<br>&lt;t:coldistance&nbsp;id=&#34;g_11&#34;&nbsp;width=&#34;100%&#34;&nbsp;/&gt;<br>&lt;t:button&nbsp;id=&#34;g_12&#34;&nbsp;actionListener=&#34;#{d.demoCharts.onUpdateChart}&#34;&nbsp;text=&#34;Update&nbsp;Chart&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:rowdistance&nbsp;id=&#34;g_13&#34;&nbsp;height=&#34;20&#34;&nbsp;/&gt;<br>&lt;t:row&nbsp;id=&#34;g_14&#34;&nbsp;&gt;<br>&lt;t:pane&nbsp;id=&#34;g_15&#34;&nbsp;background=&#34;#FFFFFF&#34;&nbsp;bgpaint=&#34;rectangle(0,0,10,100%,#00000040,#00000000,horizontal);rectangle(100%-10,0,10,100%,#00000000,#00000040,horizontal);&#34;&nbsp;border=&#34;top:1;bottom:1;color:#00000020&#34;&nbsp;padding=&#34;5&#34;&nbsp;width=&#34;100%&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_16&#34;&nbsp;&gt;<br>&lt;t:coldistance&nbsp;id=&#34;g_17&#34;&nbsp;width=&#34;50%&#34;&nbsp;/&gt;<br>&lt;t:heximagemap&nbsp;id=&#34;g_18&#34;&nbsp;actionListener=&#34;#{d.DemoCharts.onImageMapAction}&#34;&nbsp;hexdata=&#34;#{d.demoCharts.image}&#34;&nbsp;imageareas=&#34;#{d.demoCharts.imageAreas}&#34;&nbsp;/&gt;<br>&lt;t:coldistance&nbsp;id=&#34;g_19&#34;&nbsp;width=&#34;50%&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;/t:pane&gt;<br>&lt;/t:row&gt;<br>&lt;/t:rowdemobodypane&gt;<br>&lt;t:pageaddons&nbsp;id=&#34;g_pa&#34;/&gt;<br>&lt;/t:layoutdefinition&gt;</p>
<p>This is the Java code:</p>
<p class="java">package&nbsp;workplace;<br><br>import&nbsp;java.awt.Font;<br>import&nbsp;java.io.BufferedOutputStream;<br>import&nbsp;java.io.ByteArrayOutputStream;<br>import&nbsp;java.io.File;<br>import&nbsp;java.io.FileOutputStream;<br>import&nbsp;java.io.OutputStream;<br>import&nbsp;java.io.PrintWriter;<br>import&nbsp;java.util.HashMap;<br>import&nbsp;java.util.Map;<br><br>import&nbsp;javax.faces.event.ActionEvent;<br><br>import&nbsp;org.eclnt.jsfserver.defaultscreens.Statusbar;<br>import&nbsp;org.eclnt.jsfserver.elements.events.BaseActionEventImageMapAreaSelected;<br>import&nbsp;org.eclnt.jsfserver.elements.impl.FIXGRIDItem;<br>import&nbsp;org.eclnt.jsfserver.elements.impl.FIXGRIDListBinding;<br>import&nbsp;org.eclnt.util.file.FileManager;<br>import&nbsp;org.eclnt.util.log.CLog;<br>import&nbsp;org.eclnt.util.valuemgmt.ValueManager;<br>import&nbsp;org.eclnt.workplace.IWorkpageDispatcher;<br>import&nbsp;org.jfree.chart.ChartFactory;<br>import&nbsp;org.jfree.chart.ChartRenderingInfo;<br>import&nbsp;org.jfree.chart.ChartUtilities;<br>import&nbsp;org.jfree.chart.JFreeChart;<br>import&nbsp;org.jfree.chart.entity.ChartEntity;<br>import&nbsp;org.jfree.chart.entity.EntityCollection;<br>import&nbsp;org.jfree.chart.entity.StandardEntityCollection;<br>import&nbsp;org.jfree.chart.imagemap.StandardToolTipTagFragmentGenerator;<br>import&nbsp;org.jfree.chart.imagemap.ToolTipTagFragmentGenerator;<br>import&nbsp;org.jfree.chart.plot.MultiplePiePlot;<br>import&nbsp;org.jfree.chart.plot.PiePlot;<br>import&nbsp;org.jfree.data.category.CategoryDataset;<br>import&nbsp;org.jfree.data.general.DatasetUtilities;<br>import&nbsp;org.jfree.data.general.DefaultPieDataset;<br>import&nbsp;org.jfree.util.TableOrder;<br><br>public&nbsp;class&nbsp;DemoCharts&nbsp;extends&nbsp;PageBean<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;inner&nbsp;classes<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;MyRow&nbsp;extends&nbsp;FIXGRIDItem<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;m_town;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;m_inhabitants;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getTown()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;m_town;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setTown(String&nbsp;town)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_town&nbsp;=&nbsp;town;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;double&nbsp;getInhabitants()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;m_inhabitants;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setInhabitants(double&nbsp;inhabitants)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_inhabitants&nbsp;=&nbsp;inhabitants;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;members<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;FIXGRIDListBinding&lt;MyRow&gt;&nbsp;m_rows&nbsp;=&nbsp;new&nbsp;FIXGRIDListBinding&lt;MyRow&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;m_image;<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;m_imageAreas;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;constructors<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DemoCharts(IWorkpageDispatcher&nbsp;dispatcher)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(dispatcher);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initRefComponent(&#34;imagemap&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyRow&nbsp;row;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row&nbsp;=&nbsp;new&nbsp;MyRow();&nbsp;row.setTown(&#34;Bammental&#34;);&nbsp;row.setInhabitants(6800);&nbsp;m_rows.getItems().add(row);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row&nbsp;=&nbsp;new&nbsp;MyRow();&nbsp;row.setTown(&#34;Mauer&#34;);&nbsp;row.setInhabitants(4000);&nbsp;m_rows.getItems().add(row);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row&nbsp;=&nbsp;new&nbsp;MyRow();&nbsp;row.setTown(&#34;Meckesheim&#34;);&nbsp;row.setInhabitants(5300);&nbsp;m_rows.getItems().add(row);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generateChart();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;public&nbsp;usage<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;FIXGRIDListBinding&lt;MyRow&gt;&nbsp;getRows()&nbsp;{&nbsp;return&nbsp;m_rows;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setImage(String&nbsp;value)&nbsp;{&nbsp;m_image&nbsp;=&nbsp;value;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getImage()&nbsp;{&nbsp;return&nbsp;m_image;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setImageAreas(String&nbsp;value)&nbsp;{&nbsp;m_imageAreas&nbsp;=&nbsp;value;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getImageAreas()&nbsp;{&nbsp;return&nbsp;m_imageAreas;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onUpdateChart(ActionEvent&nbsp;ae)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generateChart();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onCreateNewTown(ActionEvent&nbsp;ae)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyRow&nbsp;row&nbsp;=&nbsp;new&nbsp;MyRow();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.setTown(&#34;new&nbsp;town&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_rows.getItems().add(row);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onImageMapAction(ActionEvent&nbsp;event)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(event&nbsp;instanceof&nbsp;BaseActionEventImageMapAreaSelected)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BaseActionEventImageMapAreaSelected&nbsp;e&nbsp;=&nbsp;(BaseActionEventImageMapAreaSelected)event;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;mapId&nbsp;=&nbsp;e.getMapAreaId();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;index&nbsp;=&nbsp;(new&nbsp;Integer(mapId)).intValue();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_rows.deselectCurrentSelection();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_rows.selectItem(index);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statusbar.outputError(t.toString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;private&nbsp;usage<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br><br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;generateChart()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultPieDataset&nbsp;ds&nbsp;=&nbsp;new&nbsp;DefaultPieDataset();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(MyRow&nbsp;row:&nbsp;m_rows.getItems())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds.setValue(row.getTown(),row.getInhabitants());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;image<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JFreeChart&nbsp;chart&nbsp;=&nbsp;ChartFactory.createPieChart(&#34;Some&nbsp;important&nbsp;towns&#34;,ds,true,true,false);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChartRenderingInfo&nbsp;info&nbsp;=&nbsp;new&nbsp;ChartRenderingInfo(new&nbsp;StandardEntityCollection());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteArrayOutputStream&nbsp;bos&nbsp;=&nbsp;new&nbsp;ByteArrayOutputStream();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChartUtilities.writeChartAsPNG(bos,chart,400,300,info);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_image&nbsp;=&nbsp;ValueManager.encodeHexString(bos.toByteArray());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;collect&nbsp;entity&nbsp;data<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EntityCollection&nbsp;ec&nbsp;=&nbsp;info.getEntityCollection();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuffer&nbsp;sb&nbsp;=&nbsp;new&nbsp;StringBuffer();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&lt;String,String&gt;&nbsp;shapeCoordsByName&nbsp;=&nbsp;new&nbsp;HashMap&lt;String,String&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i=0;&nbsp;i&lt;ec.getEntityCount();&nbsp;i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChartEntity&nbsp;ce&nbsp;=&nbsp;ec.getEntity(i);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ce.getToolTipText()&nbsp;==&nbsp;null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;key&nbsp;=&nbsp;ce.getToolTipText();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(ce.getToolTipText());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(ce.getToolTipText());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(ce.getToolTipText());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(ce.getToolTipText());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(ce.getToolTipText());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;index&nbsp;=&nbsp;key.lastIndexOf(&#39;:&#39;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(index&nbsp;&lt;&nbsp;0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key&nbsp;=&nbsp;key.substring(0,index);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shapeCoordsByName.put(key,ce.getShapeCoords());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;build&nbsp;area&nbsp;string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb&nbsp;=&nbsp;new&nbsp;StringBuffer();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;counter&nbsp;=&nbsp;0;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(MyRow&nbsp;row:&nbsp;m_rows.getItems())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;fragment;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fragment&nbsp;=&nbsp;shapeCoordsByName.get(row.getTown());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(sb.length()&nbsp;!=&nbsp;0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(&#34;;&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(&#34;poly(&#34;+counter+&#34;,&#34;+row.getTown()+&#34;,&#34;+fragment+&#34;)&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;counter++;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_imageAreas&nbsp;=&nbsp;sb.toString();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLog.L.log(CLog.LL_ERR,&#34;&#34;,t);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;generateChartOLD()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DefaultPieDataset&nbsp;ds&nbsp;=&nbsp;new&nbsp;DefaultPieDataset();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i=0;&nbsp;i&lt;m_rows.getItems().size();&nbsp;i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyRow&nbsp;row&nbsp;=&nbsp;m_rows.getItems().get(i);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds.setValue(row.getTown(),row.getInhabitants());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JFreeChart&nbsp;chart&nbsp;=&nbsp;ChartFactory.createPieChart(&#34;Some&nbsp;important&nbsp;towns&#34;,ds,true,true,false);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteArrayOutputStream&nbsp;bos&nbsp;=&nbsp;new&nbsp;ByteArrayOutputStream();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChartUtilities.writeChartAsPNG(bos,&nbsp;chart,&nbsp;400,&nbsp;200);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bos.close();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;image&nbsp;=&nbsp;bos.toByteArray();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_image&nbsp;=&nbsp;ValueManager.encodeHexString(image);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLog.L.log(CLog.LL_ERR,&#34;&#34;,t);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>}<br></p>
</body>
</html>
