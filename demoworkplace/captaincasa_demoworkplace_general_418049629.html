<html>
<head>
<style>
.java {font-family: monospace;background-color: #F0F0F0;}
.xml {font-family: monospace;background-color: #F0F0F0;}
</style>
</head>
<body>
<p>The context of this demo is the creation of a dialog using the CaptainCasa framework for the following purpose: <ul><li>General</li><li>Asynchronous Processing</li><li>Long Operations - Simple Variant</li></ul></p>
<p>There is a simple API to start long operations from the user interface processing on the server side.<br><br>The server side application has to define two Runnables:<br><br>(1.) The first runnable is the one that is the long operation itself. This has nothing to do with UI processing - it is started in a thread that is NO user interface related thread. It&#39;s running outside the JSF-scope! - this means you do not have access to FacesContext etc.<br><br>(2.) The second runnable it one that is executed after the first runnable is finished. The second runnable is running in the normal user interface related thread, i.e. here you have full access to the JSF environment.<br><br>During the long operation a modal popup is shown, so that the user cannot interrupt. The long lasting operation can write messages into an IObserver object - messages are transferred to the client using long polling mechanisms (i.e. there is NO usage of timers, but the messages are sent to the client using long polling).<br></p>
<p>This is the XML layout definition:</p>
<p class="xml">&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;utf-8&#34;?&gt;<br>&lt;t:layoutdefinition&nbsp;xmlns:t=&#34;http://www.CaptainCasa.com/controllibrary/t&#34;&nbsp;xmlns:tpbc=&#34;http://www.CaptainCasa.com/controllibrary/tpbc&#34;&nbsp;&gt;<br>&lt;t:rowdemobodypane&nbsp;id=&#34;g_1&#34;&nbsp;objectbinding=&#34;#{d.DemoLongOperation}&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_2&#34;&nbsp;&gt;<br>&lt;t:label&nbsp;id=&#34;g_3&#34;&nbsp;text=&#34;Long&nbsp;operation&#34;&nbsp;width=&#34;100&#34;&nbsp;/&gt;<br>&lt;t:button&nbsp;id=&#34;g_4&#34;&nbsp;actionListener=&#34;#{d.DemoLongOperation.onStartOperation}&#34;&nbsp;text=&#34;Start!&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;/t:rowdemobodypane&gt;<br>&lt;t:pageaddons&nbsp;id=&#34;g_pa&#34;/&gt;<br>&lt;/t:layoutdefinition&gt;</p>
<p>This is the Java code:</p>
<p class="java">package&nbsp;workplace;<br><br>import&nbsp;java.io.Serializable;<br><br>import&nbsp;javax.faces.event.ActionEvent;<br><br>import&nbsp;org.eclnt.editor.annotations.CCGenClass;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.DefaultScreens;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.ObserverPopup;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.Statusbar;<br>import&nbsp;org.eclnt.jsfserver.polling.LongOperationWithObserverPopup;<br>import&nbsp;org.eclnt.util.log.IObserver;<br>import&nbsp;org.eclnt.workplace.IWorkpageDispatcher;<br><br>@CCGenClass&nbsp;(expressionBase=&#34;#{d.DemoLongOperation}&#34;)<br><br>public&nbsp;class&nbsp;DemoLongOperation<br>&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;PageBean<br>&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;Serializable<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DemoLongOperation(IWorkpageDispatcher&nbsp;dispatcher)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(dispatcher);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onStartOperation(ActionEvent&nbsp;event)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;IObserver&nbsp;observer&nbsp;=&nbsp;LongOperationWithObserverPopup.prepare(&#34;My&nbsp;long&nbsp;Demo&nbsp;Operation&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;this&nbsp;operation&nbsp;has&nbsp;nothing&nbsp;to&nbsp;do&nbsp;with&nbsp;UI,&nbsp;but&nbsp;can&nbsp;add&nbsp;messages<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;to&nbsp;the&nbsp;observer.&nbsp;Within&nbsp;the&nbsp;operation&nbsp;you&nbsp;should&nbsp;not<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;use&nbsp;UI&nbsp;operations&nbsp;because&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;UI&nbsp;thread!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Runnable&nbsp;longOperation&nbsp;=&nbsp;new&nbsp;Runnable()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i=0;&nbsp;i&lt;10;&nbsp;i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;observer.addMessage(&#34;Running...&nbsp;(&#34;+i+&#34;)&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.currentThread().sleep(3000);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)&nbsp;{}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;this&nbsp;operation&nbsp;is&nbsp;called&nbsp;after&nbsp;the&nbsp;longOperation&nbsp;was&nbsp;finished:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;here&nbsp;you&nbsp;are&nbsp;within&nbsp;a&nbsp;real&nbsp;request/response&nbsp;processing,&nbsp;i.e.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;you&nbsp;have&nbsp;full&nbsp;access&nbsp;to&nbsp;all&nbsp;UI&nbsp;operations.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Runnable&nbsp;finishOperation&nbsp;=&nbsp;new&nbsp;Runnable()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statusbar.outputSuccess(&#34;Finished!&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongOperationWithObserverPopup.run(longOperation,finishOperation);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>}<br></p>
</body>
</html>
