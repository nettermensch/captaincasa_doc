<html>
<head>
<style>
.java {font-family: monospace;background-color: #F0F0F0;}
.xml {font-family: monospace;background-color: #F0F0F0;}
</style>
</head>
<body>
<p>The context of this demo is the creation of a dialog using the CaptainCasa framework for the following purpose: <ul><li>Components</li><li>Straight Controls</li><li>File Up/Download</li><li>Dynamic Download Content - TempFileManager</li></ul></p>
<p>The *DOWNLOAD components require some URL to download content from the server to the client.<br><br>In case of dynamic content you may provide this URL by using the TempFileManager: you just pass some content to the TempFileManager via a simple API - and received back a URL that you can then use for downloading.<br><br>Please note:<br><br>1. The TempFileManager uses the servlet engine&#39;s temp directory (which is part of the J2EE API definition) for storing the data. In case of Tomcat this is the tomcat/work directory.<br><br>2. The files are automatically removed when a session is removed.<br><br>3. Each file that you pass receives some unique id. The file name that is part of the API is only the last part of the file name - its main purpose is to define the name of the file that is proposed when downloading on client side.<br><br>As result loading data into the TempFileManager will not occupy any memory on server side.<br><br>In the demo the download were done by using a FILEDOWNLOADBUTTON component. Note, that there is an invisible FILEDOWNLOAD component as well (in layout definition: below BEANPROCESSING), which you can trigger from server side.</p>
<p>This is the XML layout definition:</p>
<p class="xml">&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;utf-8&#34;?&gt;<br>&lt;t:layoutdefinition&nbsp;xmlns:t=&#34;http://www.CaptainCasa.com/controllibrary/t&#34;&nbsp;xmlns:tpbc=&#34;http://www.CaptainCasa.com/controllibrary/tpbc&#34;&nbsp;&gt;<br>&lt;t:rowdemobodypane&nbsp;id=&#34;g_1&#34;&nbsp;objectbinding=&#34;#{d.DemoTempFileManager}&#34;&nbsp;rowdistance=&#34;#{ccstylevalue[&amp;#39;@defaultrowdistance@&amp;#39;]}&#34;&nbsp;&gt;<br>&lt;t:row&nbsp;id=&#34;g_2&#34;&nbsp;&gt;<br>&lt;t:filedownloadbutton&nbsp;id=&#34;g_3&#34;&nbsp;text=&#34;Download&nbsp;some&nbsp;TXT&#34;&nbsp;url=&#34;#{d.DemoTempFileManager.txtUrl}&#34;&nbsp;width=&#34;200&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_4&#34;&nbsp;&gt;<br>&lt;t:textpane&nbsp;id=&#34;g_5&#34;&nbsp;cutwidth=&#34;true&#34;&nbsp;font=&#34;size:10&#34;&nbsp;text=&#34;#{d.DemoTempFileManager.txtUrl}&#34;&nbsp;width=&#34;100%&#34;&nbsp;wordwrap=&#34;true&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:rowdistance&nbsp;id=&#34;g_6&#34;&nbsp;height=&#34;30&#34;&nbsp;/&gt;<br>&lt;t:row&nbsp;id=&#34;g_7&#34;&nbsp;&gt;<br>&lt;t:filedownloadbutton&nbsp;id=&#34;g_8&#34;&nbsp;text=&#34;Download&nbsp;some&nbsp;PNG&#34;&nbsp;url=&#34;#{d.DemoTempFileManager.pngUrl}&#34;&nbsp;width=&#34;200&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_9&#34;&nbsp;&gt;<br>&lt;t:textpane&nbsp;id=&#34;g_10&#34;&nbsp;cutwidth=&#34;true&#34;&nbsp;font=&#34;size:10&#34;&nbsp;text=&#34;#{d.DemoTempFileManager.pngUrl}&#34;&nbsp;width=&#34;100%&#34;&nbsp;wordwrap=&#34;true&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:rowdistance&nbsp;id=&#34;g_12&#34;&nbsp;height=&#34;30&#34;&nbsp;/&gt;<br>&lt;t:row&nbsp;id=&#34;g_13&#34;&nbsp;&gt;<br>&lt;t:filedownloadbutton&nbsp;id=&#34;g_14&#34;&nbsp;text=&#34;Again&nbsp;PNG&nbsp;-&nbsp;Cross&nbsp;session&#34;&nbsp;url=&#34;#{d.DemoTempFileManager.pngCrossSessionUrl}&#34;&nbsp;width=&#34;200&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;t:row&nbsp;id=&#34;g_15&#34;&nbsp;&gt;<br>&lt;t:textpane&nbsp;id=&#34;g_16&#34;&nbsp;cutwidth=&#34;true&#34;&nbsp;font=&#34;size:10&#34;&nbsp;text=&#34;#{d.DemoTempFileManager.pngCrossSessionUrl}&#34;&nbsp;width=&#34;100%&#34;&nbsp;wordwrap=&#34;true&#34;&nbsp;/&gt;<br>&lt;/t:row&gt;<br>&lt;/t:rowdemobodypane&gt;<br>&lt;t:pageaddons&nbsp;id=&#34;g_pa&#34;/&gt;<br>&lt;/t:layoutdefinition&gt;</p>
<p>This is the Java code:</p>
<p class="java">package&nbsp;workplace;<br><br>import&nbsp;java.awt.Color;<br>import&nbsp;java.awt.Font;<br>import&nbsp;java.awt.image.BufferedImage;<br>import&nbsp;java.io.ByteArrayOutputStream;<br>import&nbsp;java.io.Serializable;<br><br>import&nbsp;javax.imageio.ImageIO;<br><br>import&nbsp;org.eclnt.editor.annotations.CCGenClass;<br>import&nbsp;org.eclnt.jsfserver.defaultscreens.Statusbar;<br>import&nbsp;org.eclnt.jsfserver.util.tempfile.TempFileManager;<br>import&nbsp;org.eclnt.util.image.FontImageCreator;<br>import&nbsp;org.eclnt.workplace.IWorkpageDispatcher;<br><br>@CCGenClass&nbsp;(expressionBase=&#34;#{d.DemoTempFileManager}&#34;)<br><br>public&nbsp;class&nbsp;DemoTempFileManager<br>&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;PageBean&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;Serializable<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;inner&nbsp;classes<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;members<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br><br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;m_pngUrl;<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;m_txtUrl;<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;m_pngCrossSessionUrl;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;constructors&nbsp;&amp;&nbsp;initialization<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;DemoTempFileManager(IWorkpageDispatcher&nbsp;workpageDispatcher)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(workpageDispatcher);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buildDownloadContentTXT();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buildDownloadContentPNG();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buildDownloadContentPNGCrossSession();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getPageName()&nbsp;{&nbsp;return&nbsp;&#34;/workplace/demotempfilemanager.jsp&#34;;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getRootExpressionUsedInPage()&nbsp;{&nbsp;return&nbsp;&#34;#{d.DemoTempFileManager}&#34;;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;public&nbsp;usage<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br><br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getPngUrl()&nbsp;{&nbsp;return&nbsp;m_pngUrl;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getTxtUrl()&nbsp;{&nbsp;return&nbsp;m_txtUrl;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;getPngCrossSessionUrl()&nbsp;{&nbsp;return&nbsp;m_pngCrossSessionUrl;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;private&nbsp;usage<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;------------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;buildDownloadContentTXT()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuffer&nbsp;sb&nbsp;=&nbsp;new&nbsp;StringBuffer();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i=0;&nbsp;i&lt;100;&nbsp;i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(i&nbsp;+&nbsp;&#34;.&nbsp;This&nbsp;is&nbsp;some&nbsp;dynamically&nbsp;produced&nbsp;content.&#92;n&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;s&nbsp;=&nbsp;sb.toString();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;bytes&nbsp;=&nbsp;s.getBytes(&#34;UTF-8&#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;application/octet&nbsp;=&gt;&nbsp;browser&nbsp;directly&nbsp;downloads&nbsp;the&nbsp;file&nbsp;when&nbsp;accessed<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_txtUrl&nbsp;=&nbsp;TempFileManager.saveTempFile(&#34;dynamicallyCreatedText.txt&#34;,&#34;application/octet&#34;,bytes);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statusbar.outputAlert(&#34;Problem&nbsp;during&nbsp;content&nbsp;generation:&nbsp;&#34;&nbsp;+&nbsp;t.getMessage());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;buildDownloadContentPNG()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;s&nbsp;=&nbsp;&#34;This&nbsp;is&nbsp;some&nbsp;text.&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Font&nbsp;f&nbsp;=&nbsp;new&nbsp;Font(&#34;Arial&#34;,Font.BOLD,25);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferedImage&nbsp;bim&nbsp;=&nbsp;FontImageCreator.createImageFromText(s,&nbsp;f,&nbsp;Color.RED);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteArrayOutputStream&nbsp;bos&nbsp;=&nbsp;new&nbsp;ByteArrayOutputStream();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImageIO.write(bim,&#34;png&#34;,bos);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;bytes&nbsp;=&nbsp;bos.toByteArray();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;no&nbsp;specific&nbsp;setting&nbsp;of&nbsp;content&nbsp;type&nbsp;=&gt;&nbsp;defaults&nbsp;will&nbsp;be&nbsp;used<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_pngUrl&nbsp;=&nbsp;TempFileManager.saveTempFile(&#34;dynamicImage.png&#34;,bytes);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statusbar.outputAlert(&#34;Problem&nbsp;during&nbsp;content&nbsp;generation:&nbsp;&#34;&nbsp;+&nbsp;t.getMessage());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;buildDownloadContentPNGCrossSession()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;s&nbsp;=&nbsp;&#34;This&nbsp;is&nbsp;some&nbsp;text&nbsp;for&nbsp;the&nbsp;CROSS&nbsp;SESSION&nbsp;example.&#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Font&nbsp;f&nbsp;=&nbsp;new&nbsp;Font(&#34;Arial&#34;,Font.BOLD,25);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferedImage&nbsp;bim&nbsp;=&nbsp;FontImageCreator.createImageFromText(s,&nbsp;f,&nbsp;Color.RED);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteArrayOutputStream&nbsp;bos&nbsp;=&nbsp;new&nbsp;ByteArrayOutputStream();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImageIO.write(bim,&#34;png&#34;,bos);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;bytes&nbsp;=&nbsp;bos.toByteArray();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;no&nbsp;specific&nbsp;setting&nbsp;of&nbsp;content&nbsp;type&nbsp;=&gt;&nbsp;defaults&nbsp;will&nbsp;be&nbsp;used<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_pngCrossSessionUrl&nbsp;=&nbsp;TempFileManager.saveTempFileCrossSession(&#34;dynamicImageCrossSession.png&#34;,&#34;image/png&#34;,bytes);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;t)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statusbar.outputAlert(&#34;Problem&nbsp;during&nbsp;content&nbsp;generation:&nbsp;&#34;&nbsp;+&nbsp;t.getMessage());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></p>
</body>
</html>
